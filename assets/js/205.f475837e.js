(window.webpackJsonp=window.webpackJsonp||[]).push([[205],{563:function(t,a,s){"use strict";s.r(a);var n=s(15),r=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("系统使用 Spring Boot Admin 和 SkyWalking 实现后端服务的监控。")]),t._v(" "),a("h2",{attrs:{id:"_1-spring-boot-admin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-spring-boot-admin"}},[t._v("#")]),t._v(" 1. Spring Boot Admin")]),t._v(" "),a("p",[t._v("阅读 "),a("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/Admin/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("《芋道 Spring Boot 监控工具 Admin 入门》"),a("OutboundLink")],1),t._v(" 文章，入门 Spring Boot Admin。")]),t._v(" "),a("p",[t._v("注意，Spring Boot Admin 是内嵌在 "),a("code",[t._v("yudao-server")]),t._v(" 后端项目中，无需单独启动。")]),t._v(" "),a("h3",{attrs:{id:"_1-1-如何配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-如何配置"}},[t._v("#")]),t._v(" 1.1 如何配置？")]),t._v(" "),a("p",[t._v("① 【开启 Spring Boot Admin Client 客户端】修改 "),a("code",[t._v("yudao-spring-boot-starter-monitor")]),t._v(" 模块的 "),a("code",[t._v("pom.xml")]),t._v("  依赖，将如下依赖打开（去掉 "),a("code",[t._v("<optional>true</optional>")]),t._v(" 部分）：")]),t._v(" "),a("div",{staticClass:"language-XML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("de.codecentric"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-admin-starter-client"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 实现 Spring Boot Admin Client 客户端 --\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("② 【开启 Spring Boot Admin Server 服务端】修改 "),a("code",[t._v("yudao-module-infra")]),t._v(" 模块的 "),a("code",[t._v("pom.xml")]),t._v("  依赖，将如下依赖打开（去掉 "),a("code",[t._v("<optional>true</optional>")]),t._v(" 部分）：")]),t._v(" "),a("div",{staticClass:"language-XML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("de.codecentric"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-admin-starter-server"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 实现 Spring Boot Admin Server 服务端 --\x3e")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("optional")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("optional")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("之后，使用 IDEA 刷新下 Maven 依赖！！！")]),t._v(" "),a("h3",{attrs:{id:"_1-2-如何使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-如何使用"}},[t._v("#")]),t._v(" 1.2 如何使用？")]),t._v(" "),a("p",[t._v("::: tip：默认登录账号、密码都是 admin")]),t._v(" "),a("p",[t._v("如果需要修改 Spring Boot 配置文件中，"),a("code",[t._v("spring.boot.admin.client.username")]),t._v(" 和 "),a("code",[t._v("spring.boot.admin.client.password")]),t._v(" 配置项（对应的 AdminServerConfiguration 配置类）。")]),t._v(" "),a("p",[t._v("注意：生产环境下，一定要修改登录账号、密码！！！\n:::")]),t._v(" "),a("p",[t._v("① 访问 "),a("a",{attrs:{href:"http://127.0.0.1:48080/admin/applications",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:48080/admin/applications"),a("OutboundLink")],1),t._v(" 地址，可以在 Spring Boot Admin 中，查看到应用与实例的列表。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/02.png",alt:"应用 - 列表"}})]),t._v(" "),a("p",[t._v("② 点击 "),a("code",[t._v("yudao-server")]),t._v(" 应用，再点击实例，可以查看到该实例的细节信息。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/03.png",alt:"应用 - 明细"}})]),t._v(" "),a("p",[t._v("③ 点击 [日志 -> 日志文件] 菜单，查看该示例的日志内容。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/04.png",alt:"应用 - 日志"}})]),t._v(" "),a("p",[t._v("点击 [日志 -> 日志文件] 菜单，可动态修改 Logger 的日志级别，方便排查线上的某些 BUG。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/05.png",alt:"应用 - 日志"}})]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("补充说明：也可以通过前端的 [基础设施 -> 监控中心 -> Java 监控] 菜单。")]),t._v(" "),a("p",[t._v("前端 [基础设施 -> 监控中心 -> Java 监控] 菜单，通过 iframe 内嵌后端 "),a("code",[t._v("/admin/applications")]),t._v(" 路径。")]),t._v(" "),a("p",[t._v("如果你想自定义地址，可以前往 [基础设置 -> 配置管理] 菜单，设置 key 为 "),a("code",[t._v("url.spring-boot-admin")]),t._v(" 配置项。")])]),t._v(" "),a("h3",{attrs:{id:"_1-3-常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-常见问题"}},[t._v("#")]),t._v(" 1.3 常见问题？")]),t._v(" "),a("h4",{attrs:{id:"_1-3-1-如何开启登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-如何开启登录"}},[t._v("#")]),t._v(" 1.3.1 如何开启登录？")]),t._v(" "),a("p",[t._v("生产环境下，建议 Spring Boot Admin 开启“安全认证”的功能，避免出现安全事故。")]),t._v(" "),a("p",[t._v("由于项目本身已经使用 Spring Security 做安全认证，再额外配置 Spring Boot Admin 的“安全认证”有点麻烦。我自己是拓展 Spring Security 解决，预计"),a("a",{attrs:{href:"https://yunai1024.notion.site/druid-admin-9d856cf606a74e5e9f07438b03b0142b?pvs=4",target:"_blank",rel:"noopener noreferrer"}},[t._v("需要改 2-3 个类"),a("OutboundLink")],1),t._v("，不是很建议。")]),t._v(" "),a("p",[t._v("那么怎么办呢？可以参考 "),a("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/Admin/",target:"_blank",rel:"noopener noreferrer"}},[t._v("《芋道 Spring Boot 监控工具 Admin 入门》"),a("OutboundLink")],1),t._v(" 文档，额外搭建一个 Spring Boot Admin 进程，然后项目接入它使用！")]),t._v(" "),a("h4",{attrs:{id:"_1-3-2-prod-生产环境下-后端部署多个-jvm-进程时-spring-boot-admin-client-url-填写哪个-ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-prod-生产环境下-后端部署多个-jvm-进程时-spring-boot-admin-client-url-填写哪个-ip"}},[t._v("#")]),t._v(" 1.3.2 prod 生产环境下，后端部署多个 JVM 进程时，spring.boot.admin.client.url 填写哪个 IP？")]),t._v(" "),a("ul",[a("li",[t._v("第一步，在 Nginx 中配置 "),a("code",[t._v("/admin")]),t._v(" 路径，转发到多个 JVM 的 IP 上，使用 "),a("a",{attrs:{href:"https://blog.csdn.net/bolg_hero/article/details/73382117",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("backup")]),a("OutboundLink")],1),t._v(" 参数实现主备。注意，该转发只允许内网访问，避免安全问题！！！")]),t._v(" "),a("li",[t._v("第二步，设置 "),a("code",[t._v("spring.boot.admin.client.url")]),t._v(" 配置项，为 Nginx 的 "),a("code",[t._v("内置 IP/admin")]),t._v(" 地址。")])]),t._v(" "),a("h4",{attrs:{id:"_1-3-3-spring-boot-admin-server-是否可以独立"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-spring-boot-admin-server-是否可以独立"}},[t._v("#")]),t._v(" 1.3.3 Spring Boot Admin Server 是否可以独立？")]),t._v(" "),a("p",[t._v("确实，也是非常推荐 Spring Boot Admin Server 的。推荐阅读 "),a("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/Admin/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("《芋道 Spring Boot 监控工具 Admin 入门》"),a("OutboundLink")],1),t._v(" 文章，单独搭建 Spring Boot Admin Server 服务端。")]),t._v(" "),a("p",[t._v("然后，参考「1.3.2」问题，将 "),a("code",[t._v("spring.boot.admin.client.url")]),t._v(" 配置项，为 Spring Boot Admin Server 的地址即可。")]),t._v(" "),a("p",[t._v("当然，原本项目只需要引入 "),a("code",[t._v("spring-boot-admin-starter-client")]),t._v(" 依赖，不用引入 "),a("code",[t._v("spring-boot-admin-starter-server")]),t._v(" 依赖！！！")]),t._v(" "),a("h2",{attrs:{id:"_2-skywalking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-skywalking"}},[t._v("#")]),t._v(" 2. SkyWalking")]),t._v(" "),a("p",[t._v("阅读 "),a("a",{attrs:{href:"https://www.iocoder.cn/SkyWalking/install/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("《芋道 SkyWalking 极简入门》"),a("OutboundLink")],1),t._v(" 文章，入门 SkyWalking。")]),t._v(" "),a("p",[t._v("注意，SkyWalking 需要单独启动，预计需要 4 核 8G 的硬件资源。")]),t._v(" "),a("h3",{attrs:{id:"_2-1-如何配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-如何配置"}},[t._v("#")]),t._v(" 2.1 如何配置？")]),t._v(" "),a("p",[t._v("① 修改 "),a("code",[t._v("yudao-spring-boot-starter-monitor")]),t._v(" 模块的 "),a("code",[t._v("pom.xml")]),t._v("  依赖，将如下依赖打开（去掉 "),a("code",[t._v("<optional>true</optional>")]),t._v(" 部分）：")]),t._v(" "),a("div",{staticClass:"language-XML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 监控相关 --\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.opentracing"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("opentracing-util"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.skywalking"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("apm-toolkit-trace"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.skywalking"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("apm-toolkit-logback-1.x"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.skywalking"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("apm-toolkit-opentracing"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("② 修改所有 "),a("code",[t._v("logback-spring.xml")]),t._v(" 日志配置中，添加 SkyWalking 收集日志的 appender 配置。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/skywalking%E6%97%A5%E5%BF%97.png",alt:" 配置"}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("【可选】补充说明：")]),t._v(" "),a("p",[t._v("默认情况下，控制台 "),a("code",[t._v("STDOUT")]),t._v(" 和 "),a("code",[t._v("FILE")]),t._v(" 的 Appender 日志输出，是不带 "),a("code",[t._v("tid")]),t._v(" 链路追踪编号。")]),t._v(" "),a("p",[t._v("可以参考 "),a("code",[t._v("SKYWALKING")]),t._v(" Appender 的 "),a("code",[t._v("encoder")]),t._v(" 部分的配置，添加上 LayoutWrappingEncoder、TraceIdPatternLogbackLayout 部分，就是如下：")]),t._v(" "),a("div",{staticClass:"language-XML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("encoder")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ch.qos.logback.core.encoder.LayoutWrappingEncoder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("layout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("[%tid] ${FILE_LOG_PATTERN}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("layout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("encoder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("<pattern>")]),t._v(" 里面的重点是 "),a("code",[t._v("[%tid]")]),t._v(" 部分，并且要写对 "),a("code",[t._v("CONSOLE_LOG_PATTERN")]),t._v(" 或 "),a("code",[t._v("FILE_LOG_PATTERN")]),t._v(" 噢！！！")])])]),t._v(" "),a("p",[t._v("③ 修改 SkyWalking 在前端项目的 [基础设施 -> 监控中心 -> 链路追踪] 对应的 "),a("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/src/views/infra/skywalking/index.vue#L11",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("skywaling/index.vue")]),a("OutboundLink")],1),t._v(" 文件，调整为你 SkyWalking 的访问地址。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/11.png",alt:" 文件"}})]),t._v(" "),a("h3",{attrs:{id:"_2-2-如何使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-如何使用"}},[t._v("#")]),t._v(" 2.2 如何使用？")]),t._v(" "),a("p",[t._v("① 点击 [基础设施 -> 监控中心 -> 链路追踪] 菜单，可以看到 SkyWalking 提供的链路追踪。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/21.png",alt:"基础设施 -> 链路追踪"}})]),t._v(" "),a("p",[t._v("② 点击 "),a("code",[t._v("yudao-server")]),t._v(" 服务，查看该服务的监控信息。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/22.png",alt:" 服务"}})]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("补充说明：")]),t._v(" "),a("p",[t._v("前端 [基础设施 -> 监控中心 -> 链路追踪] 菜单，通过 iframe 内嵌 "),a("code",[t._v("http://skywalking.iocoder.cn")]),t._v(" 路径。")]),t._v(" "),a("p",[t._v("如果你想自定义地址，可以前往 [基础设置 -> 配置管理] 菜单，设置 key 为 "),a("code",[t._v("url.skywalking")]),t._v(" 配置项。")])]),t._v(" "),a("h2",{attrs:{id:"_3-更多监控系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-更多监控系统"}},[t._v("#")]),t._v(" 3. 更多监控系统")]),t._v(" "),a("h3",{attrs:{id:"_3-1-prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-prometheus"}},[t._v("#")]),t._v(" 3.1 Prometheus")]),t._v(" "),a("p",[t._v("参见 "),a("a",{attrs:{href:"https://www.iocoder.cn/Prometheus/install/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("《芋道 Prometheus + Grafana + Alertmanager 极简入门 》"),a("OutboundLink")],1),t._v(" 文章。")]),t._v(" "),a("p",[t._v("注意，修改项目的 "),a("code",[t._v("yudao-spring-boot-starter-monitor")]),t._v(" 模块的 "),a("code",[t._v("pom.xml")]),t._v("  依赖，将如下依赖打开（去掉 "),a("code",[t._v("<optional>true</optional>")]),t._v(" 部分）：")]),t._v(" "),a("div",{staticClass:"language-XML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Micrometer 对 Prometheus 的支持 --\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.micrometer"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("micrometer-registry-prometheus"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("optional")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("optional")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-2-elk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-elk"}},[t._v("#")]),t._v(" 3.2 ELK")]),t._v(" "),a("p",[t._v("参见 "),a("a",{attrs:{href:"https://www.iocoder.cn/Elasticsearch/ELK-install/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("芋道 ELK(Elasticsearch + Logstash + Kibana) 极简入门"),a("OutboundLink")],1),t._v(" 文章。")]),t._v(" "),a("h3",{attrs:{id:"_3-3-sentry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-sentry"}},[t._v("#")]),t._v(" 3.3 Sentry")]),t._v(" "),a("p",[t._v("参见 "),a("a",{attrs:{href:"https://www.iocoder.cn/Sentry/install/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("《Sentry 极简入门 》"),a("OutboundLink")],1),t._v(" 文章。")])])}),[],!1,null,null,null);a.default=r.exports}}]);